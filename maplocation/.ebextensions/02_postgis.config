commands:
  01_install_gdal:
    command: |
      # Install GDAL/GEOS for PostGIS support
      # Works with both yum and dnf (Amazon Linux 2 and AL2023)
      if command -v dnf &> /dev/null; then
        echo "Using dnf package manager"
        dnf install -y gdal gdal-devel geos geos-devel proj proj-devel || true
      elif command -v yum &> /dev/null; then
        echo "Using yum package manager"
        yum install -y gdal gdal-devel geos geos-devel proj proj-devel || true
      else
        echo "No package manager found, GDAL may not be installed"
      fi
      # Verify installation
      ldconfig
      echo "GDAL installation check:"
      find /usr -name "libgdal*" -o -name "libgeos*" 2>/dev/null || echo "No GDAL/GEOS libraries found"
    ignoreErrors: false

  02_enable_postgis:
    command: |
      # Enable PostGIS extension on RDS (requires superuser, may fail gracefully)
      # This should be run manually via psql or RDS console if it fails
      echo "PostGIS extension should be enabled manually on RDS if not already done"
      echo "Run: CREATE EXTENSION IF NOT EXISTS postgis; as RDS superuser"
    ignoreErrors: true
