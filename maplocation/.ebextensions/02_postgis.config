commands:
  01_install_epel:
    command: |
      # Install EPEL repository for Amazon Linux 2023
      dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm || true
    ignoreErrors: true

  02_install_gdal:
    command: |
      # Install GDAL and dependencies
      dnf install -y gdal gdal-libs gdal-devel geos geos-devel proj proj-devel || \
      yum install -y gdal gdal-libs gdal-devel geos geos-devel proj proj-devel || true
      ldconfig
    ignoreErrors: true

  03_verify_gdal:
    command: |
      echo "=== GDAL Installation Verification ==="
      which gdalinfo || echo "gdalinfo command not found"
      ldconfig -p | grep -i "libgdal\|libgeos" || echo "GDAL/GEOS libraries not found in ldconfig"
      find /usr/lib* -name "libgdal*" -o -name "libgeos*" 2>/dev/null | head -10 || echo "No library files found"
    ignoreErrors: true

  02_enable_postgis:
    command: |
      # Enable PostGIS extension on RDS (requires superuser, may fail gracefully)
      # This should be run manually via psql or RDS console if it fails
      echo "PostGIS extension should be enabled manually on RDS if not already done"
      echo "Run: CREATE EXTENSION IF NOT EXISTS postgis; as RDS superuser"
    ignoreErrors: true
